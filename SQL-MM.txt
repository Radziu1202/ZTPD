Cwiczenie 1 

A:

select lpad('-',2*(level-1),'|-') || t.owner||'.'||t.type_name||' (FINAL:'||t.final||
', INSTANTIABLE:'||t.instantiable||', ATTRIBUTES:'||t.attributes||', METHODS:'||t.methods||')'
from all_types t
start with t.type_name = 'ST_GEOMETRY'
connect by prior t.type_name = t.supertype_name
 and prior t.owner = t.owner;


B:

select distinct m.method_name
from all_type_methods m
where m.type_name like 'ST_POLYGON'
and m.owner = 'MDSYS'
order by 1;
	
C:

CREATE TABLE MYST_MAJOR_CITIES (
    FIPS_CNTRY VARCHAR2(2),
    CITY_NAME VARCHAR2(40),
    STGEOM ST_POINT
);

D:

INSERT INTO MYST_MAJOR_CITIES
SELECT
    FIPS_CNTRY,
    CITY_NAME,
    ST_POINT(GEOM) STGEOM
FROM MAJOR_CITIES;



cwiczenie 2:

A:

INSERT INTO MYST_MAJOR_CITIES VALUES ('PL','SZCZYRK', TREAT(ST_POINT.FROM_WKT('POINT (19.036107 49.718655)') AS ST_POINT));


B:
SELECT name, TREAT(ST_POINT.FROM_SDO_GEOM(GEOM) AS ST_GEOMETRY).GET_WKT() From rivers;

C:

SELECT SDO_UTIL.TO_GMLGEOMETRY(ST_POINT.GET_SDO_GEOM(STGEOM)) GML
FROM MYST_MAJOR_CITIES 
WHERE CITY_NAME = 'SZCZYRK';

cwiczenie 3:
A:
CREATE TABLE MYST_COUNTRY_BOUNDARIES (
    FIPS_CNTRY VARCHAR2(2),
    CNTRY_NAME VARCHAR2(40),
    STGEOM ST_MULTIPOLYGON
);

B:

INSERT INTO MYST_COUNTRY_BOUNDARIES
SELECT FIPS_CNTRY, CNTRY_NAME, ST_MULTIPOLYGON(GEOM)
FROM COUNTRY_BOUNDARIES;

C:
SELECT m.STGEOM.ST_GEOMETRYTYPE() AS TYP_OBIEKTU, COUNT(*) AS ILE FROM MYST_COUNTRY_BOUNDARIES m
GROUP BY m.STGEOM.ST_GEOMETRYTYPE();

D:
SELECT m.STGEOM.ST_ISSIMPLE()
FROM MYST_COUNTRY_BOUNDARIES m;

cwiczenie 4

A:

SELECT m.CNTRY_NAME, COUNT(*)
FROM MYST_COUNTRY_BOUNDARIES m, MYST_MAJOR_CITIES mc
WHERE mc.STGEOM.ST_WITHIN(m.STGEOM) = 1
GROUP BY m.CNTRY_NAME;

Błąd wynika z tego że obiekty geometrii różnią się jesli chodzi o sustemy współrzędnych.

UPDATE MYST_MAJOR_CITIES m  SET m.STGEOM = ST_POINT(m.STGEOM.ST_X(), m.STGEOM.ST_Y(), 8307) 
WHERE m.CITY_NAME = 'Szczyrk';


B:

SELECT m1.CNTRY_NAME A_NAME, m2.CNTRY_NAME B_NAME
FROM MYST_COUNTRY_BOUNDARIES m1, MYST_COUNTRY_BOUNDARIES m2
WHERE m1.STGEOM.ST_TOUCHES(m2.STGEOM) = 1 
AND m2.CNTRY_NAME = 'Czech Republic';

C:

SELECT DISTINCT m.CNTRY_NAME, r.NAME
FROM MYST_COUNTRY_BOUNDARIES m, RIVERS r
WHERE m.STGEOM.ST_CROSSES(ST_LINESTRING(r.GEOM)) = 1
AND m.CNTRY_NAME = 'Czech Republic';

D:

SELECT ROUND(TREAT(m1.STGEOM.ST_UNION(m2.STGEOM) AS ST_POLYGON).ST_AREA(), -2) POWIERZCHNIA
FROM MYST_COUNTRY_BOUNDARIES m1, MYST_COUNTRY_BOUNDARIES m2 WHERE m1.CNTRY_NAME = 'Czech Republic' AND m2.CNTRY_NAME = 'Slovakia';

E:

SELECT m.STGEOM OBIEKT, m.STGEOM.ST_DIFFERENCE(ST_GEOMETRY(W.GEOM)).ST_GEOMETRYTYPE() WEGRY_BEZ
FROM MYST_COUNTRY_BOUNDARIES m, WATER_BODIES w WHERE  m.CNTRY_NAME = 'Hungary' AND w.NAME = 'Balaton';

Cwiczenie 5

A:
EXPLAIN PLAN FOR SELECT m.CNTRY_NAME A_NAME, COUNT(*)
FROM MYST_COUNTRY_BOUNDARIES m, MYST_MAJOR_CITIES c
WHERE SDO_WITHIN_DISTANCE(c.STGEOM, m.STGEOM, 'distance=100 unit=km') = 'TRUE'
    AND m.CNTRY_NAME = 'Poland'
GROUP BY m.CNTRY_NAME;

SELECT PLAN_TABLE_OUTPUT FROM TABLE(DBMS_XPLAN.DISPLAY);

B:

INSERT INTO USER_SDO_GEOM_METADATA
SELECT  'STGEOM','MYST_MAJOR_CITIES', m.DIMINFO, m.SRID
FROM   ALL_SDO_GEOM_METADATA m
WHERE  m.TABLE_NAME = 'MAJOR_CITIES';

C:
create index MYST_MAJOR_CITIES_IDX on
MYST_MAJOR_CITIES(STGEOM)
indextype IS MDSYS.SPATIAL_INDEX;


D:

EXPLAIN PLAN FOR
select m.CNTRY_NAME A_NAME, count(*)
from MYST_COUNTRY_BOUNDARIES m, MYST_MAJOR_CITIES c
where SDO_WITHIN_DISTANCE(c.STGEOM, m.STGEOM, 'distance=100 unit=km') = 'TRUE'
and c.CITY_NAME <> 'Szczyrk' and m.CNTRY_NAME = 'Poland'
group by m.CNTRY_NAME;

select PLAN_TABLE_OUTPUT FROM TABLE(DBMS_XPLAN.DISPLAY);

indeksy zostaly wykorzystane
